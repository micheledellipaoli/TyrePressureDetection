metadata:
  name: mqtt_simulate_tyre_puncture
  labels:
    nuclio.io/project-name: 7f15a68a-45e2-4006-a7cf-f5ec6148febd
spec:
  description: "Function that generates 5 messages on the "iot/tyre/pressure" topics, each one containing a pressure valuee minor than the standard one."
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mqtt_simulate_tyre_puncture:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwp2YXIgbXF0dF91cmwgPSB1cmwucGFyc2UocHJvY2Vzcy5lbnYuQ0xPVURBTVFQX01RVFRfVVJMIHx8ICdtcXR0Oi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjIyLjgzLjY3OjE4ODMnKTsKdmFyIGF1dGggPSAobXF0dF91cmwuYXV0aCB8fCAnOicpLnNwbGl0KCc6Jyk7CnZhciB1cmwgPSAibXF0dDovLyIgKyBtcXR0X3VybC5ob3N0OwoKdmFyIG9wdGlvbnMgPSB7Cglwb3J0OiBtcXR0X3VybC5wb3J0LAoJY2xpZW50SWQ6ICdtcXR0anNfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cigyLCA4KSwKCXVzZXJuYW1lOiBhdXRoWzBdLAoJcGFzc3dvcmQ6IGF1dGhbMV0sCn07Cgp2YXIgc3RhbmRhcmRQcmVzc3VyZSA9IDMwMDA7CnZhciBtaW5EZWx0YVByZXNzdXJlICA9IDEwOwp2YXIgbWF4RGVsdGFQcmVzc3VyZSAgPSA2MDA7Cgp2YXIgbWluRGVsdGFUaW1lID0gMTsKdmFyIG1heERlbHRhVGltZSA9IDU7Cgp2YXIgcHJlc3N1cmUgPSBbMCwwLDAsMCwwXTsKdmFyIHRpbWVzdGFtcCA9IFswLDAsMCwwLDBdOwoKZnVuY3Rpb24gZ2VuZXJhdGVEYXRhKGNhbGxiYWNrKXsgICAKICAgIHZhciByZXN1bHQgPSBbIiIsIiIsIiIsIiIsIiJdOyAKICAgIGZvcih2YXIgaT0wOyBpPDU7IGkrKyl7CgkgICAgdmFyIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKG1heERlbHRhUHJlc3N1cmUtbWluRGVsdGFQcmVzc3VyZSkpK21pbkRlbHRhUHJlc3N1cmU7CgkgICAgaWYoaT09MCl7CgkJICAgIHByZXNzdXJlW2ldID0gc3RhbmRhcmRQcmVzc3VyZS15OwoJCSAgICB0aW1lc3RhbXBbaV0gPSBuZXcgRGF0ZSgpOwoJICAgIH1lbHNlewoJCSAgICBwcmVzc3VyZVtpXSA9IHByZXNzdXJlW2ktMV0teTsKCQkgICAgdGltZXN0YW1wW2ldID0gdGltZXN0YW1wW2ktMV07CiAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihtYXhEZWx0YVRpbWUtbWluRGVsdGFUaW1lKSkrbWluRGVsdGFUaW1lOwoJCSAgICB0aW1lc3RhbXBbaV0uc2V0U2Vjb25kcyh0aW1lc3RhbXBbaV0uZ2V0U2Vjb25kcygpICsgeCk7CgkgICAgfQogICAgICAgIHJlc3VsdFtpXSA9IHByZXNzdXJlW2ldLnRvU3RyaW5nKCkgKyAiLSIgKyB0aW1lc3RhbXBbaV0udG9TdHJpbmcoKTsKICAgICAgICAKICAgIH0KICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7Cn0KCmZ1bmN0aW9uIGluc2VydERhdGEoZXJyLCByZXN1bHRzLCBjYWxsYmFjayl7CiAgICBpZiAoZXJyKSB0aHJvdyBlcnI7CgogICAgdmFyIG1zZyA9ICIiOwogICAgdmFyIGNsaWVudCA9IG1xdHQuY29ubmVjdCh1cmwsIG9wdGlvbnMpOwogICAgY2xpZW50Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yKGxldCByZWNvcmQgb2YgcmVzdWx0cyl7CiAgICAgICAgICAgICAgICBjbGllbnQucHVibGlzaCgnaW90L3R5cmUvcHJlc3N1cmUnLCByZWNvcmQudG9TdHJpbmcoKSwgZnVuY3Rpb24oKSB7fSk7CiAgICAgICAgfTsKICAgIGNsaWVudC5lbmQoKTsKICAgIH0pOyAgICAKfQoKZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24oY29udGV4dCwgZXZlbnQpIHsKICAgIGdlbmVyYXRlRGF0YShmdW5jdGlvbihlcnIsIGRhdGEpewogICAgICAgIGluc2VydERhdGEobnVsbCwgZGF0YSk7CiAgICB9KTsKICAgIGNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrIik7ICAKfQoK
    commands:
      - 'npm install mqtt'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
