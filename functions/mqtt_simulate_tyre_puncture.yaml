metadata:
  name: mqtt_simulate_tyre_puncture
  labels:
    nuclio.io/project-name: 7f15a68a-45e2-4006-a7cf-f5ec6148febd
spec:
  description: "Function that generates 5 messages on the "iot/tyre/pressure" topics, each one containing a pressure valuee minor than the standard one."
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mqtt_simulate_tyre_puncture:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  build:
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwp2YXIgbXF0dF91cmwgPSB1cmwucGFyc2UocHJvY2Vzcy5lbnYuQ0xPVURBTVFQX01RVFRfVVJMIHx8ICdtcXR0Oi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjI0LjIzLjUzOjE4ODMnKTsKdmFyIGF1dGggPSAobXF0dF91cmwuYXV0aCB8fCAnOicpLnNwbGl0KCc6Jyk7CnZhciB1cmwgPSAibXF0dDovLyIgKyBtcXR0X3VybC5ob3N0OwoKdmFyIG9wdGlvbnMgPSB7Cglwb3J0OiBtcXR0X3VybC5wb3J0LAoJY2xpZW50SWQ6ICdtcXR0anNfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cigyLCA4KSwKCXVzZXJuYW1lOiBhdXRoWzBdLAoJcGFzc3dvcmQ6IGF1dGhbMV0sCn07CgovKgp2YXIgc3RhbmRhcmRQcmVzc3VyZSA9IDMwMDA7CnZhciBtaW5EZWx0YVByZXNzdXJlID0gMTA7CnZhciBtYXhEZWx0YVByZXNzdXJlID0gMTAwOwoqLwp2YXIgc3RhbmRhcmRQcmVzc3VyZSA9IDMyOwp2YXIgbWluRGVsdGFQcmVzc3VyZSA9IDI7CnZhciBtYXhEZWx0YVByZXNzdXJlID0gNTsKCnZhciBtaW5EZWx0YVRpbWUgPSAxOwp2YXIgbWF4RGVsdGFUaW1lID0gNTsKCnZhciBwcmVzc3VyZSA9IFswLDAsMCwwLDBdOwp2YXIgdGltZXN0YW1wID0gWzAsMCwwLDAsMF07CgpmdW5jdGlvbiBnZW5lcmF0ZURhdGEoY2FsbGJhY2speyAgIAogICAgdmFyIHJlc3VsdCA9IFsiIiwiIiwiIiwiIiwiIl07IAogICAgZm9yKHZhciBpPTA7IGk8NTsgaSsrKXsKCSAgICB2YXIgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoobWF4RGVsdGFQcmVzc3VyZS1taW5EZWx0YVByZXNzdXJlKSkrbWluRGVsdGFQcmVzc3VyZTsKCSAgICBpZihpPT0wKXsKCQkgICAgcHJlc3N1cmVbaV0gPSBzdGFuZGFyZFByZXNzdXJlLXk7CgkJICAgIHRpbWVzdGFtcFtpXSA9IG5ldyBEYXRlKCk7CgkgICAgfWVsc2V7CgkJICAgIHByZXNzdXJlW2ldID0gcHJlc3N1cmVbaS0xXS15OwoJCSAgICB0aW1lc3RhbXBbaV0gPSB0aW1lc3RhbXBbaS0xXTsKICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKG1heERlbHRhVGltZS1taW5EZWx0YVRpbWUpKSttaW5EZWx0YVRpbWU7CgkJICAgIHRpbWVzdGFtcFtpXS5zZXRTZWNvbmRzKHRpbWVzdGFtcFtpXS5nZXRTZWNvbmRzKCkgKyB4KTsKCSAgICB9CiAgICAgICAgcmVzdWx0W2ldID0gcHJlc3N1cmVbaV0udG9TdHJpbmcoKSArICItIiArIHRpbWVzdGFtcFtpXS50b1N0cmluZygpOwogICAgICAgIAogICAgfQogICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTsKfQoKZnVuY3Rpb24gaW5zZXJ0RGF0YShlcnIsIHJlc3VsdHMsIGNhbGxiYWNrKXsKICAgIGlmIChlcnIpIHRocm93IGVycjsKCiAgICB2YXIgbXNnID0gIiI7CiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KHVybCwgb3B0aW9ucyk7CiAgICBjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbigpIHsKICAgICAgICBmb3IobGV0IHJlY29yZCBvZiByZXN1bHRzKXsKICAgICAgICAgICAgICAgIGNsaWVudC5wdWJsaXNoKCdpb3QvdHlyZS9wcmVzc3VyZScsIHJlY29yZC50b1N0cmluZygpLCBmdW5jdGlvbigpIHt9KTsKICAgICAgICB9OwogICAgY2xpZW50LmVuZCgpOwogICAgfSk7ICAgIAp9CgpleHBvcnRzLmhhbmRsZXIgPSBmdW5jdGlvbihjb250ZXh0LCBldmVudCkgewogICAgZ2VuZXJhdGVEYXRhKGZ1bmN0aW9uKGVyciwgZGF0YSl7CiAgICAgICAgaW5zZXJ0RGF0YShudWxsLCBkYXRhKTsKICAgIH0pOwogICAgY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2siKTsgIAp9Cgo=
    commands:
      - 'npm install mqtt'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
  version: 1
