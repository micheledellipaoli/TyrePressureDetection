metadata:
  name: mqtt_simulate_low_tyre_pressure
  labels:
    nuclio.io/project-name: 7f15a68a-45e2-4006-a7cf-f5ec6148febd
spec:
  description: "Function that generates an event on the MQTT queue, by sending a tyre pressure value minor than the standard one."
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mqtt_simulate_low_tyre_pressure:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwp2YXIgbXF0dF91cmwgPSB1cmwucGFyc2UocHJvY2Vzcy5lbnYuQ0xPVURBTVFQX01RVFRfVVJMIHx8ICdtcXR0Oi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjMwLjkyLjE3MjoxODgzJyk7CnZhciBhdXRoID0gKG1xdHRfdXJsLmF1dGggfHwgJzonKS5zcGxpdCgnOicpOwp2YXIgdXJsID0gIm1xdHQ6Ly8iICsgbXF0dF91cmwuaG9zdDsKCnZhciBvcHRpb25zID0gewoJcG9ydDogbXF0dF91cmwucG9ydCwKCWNsaWVudElkOiAnbXF0dGpzXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHIoMiwgOCksCgl1c2VybmFtZTogYXV0aFswXSwKCXBhc3N3b3JkOiBhdXRoWzFdLAp9OwoKdmFyIHN0YW5kYXJkUHJlc3N1cmUgPSAzMDAwOwp2YXIgbWluRGVsdGFQcmVzc3VyZSA9IDEwOwp2YXIgbWF4RGVsdGFQcmVzc3VyZSA9IDYwMDsKCmZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tUHJlc3N1cmUoY2FsbGJhY2spewoJdmFyIHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqKG1heERlbHRhUHJlc3N1cmUtbWluRGVsdGFQcmVzc3VyZSkpK21pbkRlbHRhUHJlc3N1cmU7Cgl2YXIgcHJlc3N1cmUgPSBzdGFuZGFyZFByZXNzdXJlLXk7Cgl2YXIgdGltZXN0YW1wID0gbmV3IERhdGUoKTsKICAgIHZhciByZXN1bHQgPSBwcmVzc3VyZS50b1N0cmluZygpICsgIi0iICsgdGltZXN0YW1wLnRvU3RyaW5nKCk7CgkKICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7IAp9CgpmdW5jdGlvbiBpbnNlcnREYXRhKGVyciwgZGF0YSwgY2FsbGJhY2spewogICAgaWYgKGVycikgdGhyb3cgZXJyOwogICAgCiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KHVybCwgb3B0aW9ucyk7ICAgICAgICAgICAgCgljbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbigpIHsgICAgCgkgICAgY2xpZW50LnB1Ymxpc2goJ2lvdC90eXJlL3ByZXNzdXJlJywgZGF0YS50b1N0cmluZygpLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgY2xpZW50LmVuZCgpOwogICAgICAgICAgICBjYWxsYmFjaygnTVFUVCBNZXNzYWdlIFNlbnQgLSBMb3cgVHlyZSBQcmVzc3VyZTogJyArIGRhdGEudG9TdHJpbmcoKSk7CgkJfSk7CiAgICB9KTsKfQoKZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24oY29udGV4dCwgZXZlbnQpIHsKICAgIGdlbmVyYXRlUmFuZG9tUHJlc3N1cmUoZnVuY3Rpb24oZXJyLCBkYXRhKXsKICAgICAgICBpbnNlcnREYXRhKG51bGwsIGRhdGEsIGZ1bmN0aW9uKGRhdGEpewogICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKGRhdGEpOwogICAgICAgIH0pOwogICAgfSk7Cn07
    commands:
      - 'npm install mqtt'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
