metadata:
  name: mqtt_simulate_tyre_puncture
  labels:
    nuclio.io/project-name: 7f15a68a-45e2-4006-a7cf-f5ec6148febd
spec:
  description: "Function that generates 5 messages on the "iot/tyre/pressure" topics, each one containing a pressure valuee minor than the standard one."
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-mqtt_simulate_tyre_puncture:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwp2YXIgbXF0dF91cmwgPSB1cmwucGFyc2UocHJvY2Vzcy5lbnYuQ0xPVURBTVFQX01RVFRfVVJMIHx8ICdtcXR0Oi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjMwLjkyLjE3MjoxODgzJyk7CnZhciBhdXRoID0gKG1xdHRfdXJsLmF1dGggfHwgJzonKS5zcGxpdCgnOicpOwp2YXIgdXJsID0gIm1xdHQ6Ly8iICsgbXF0dF91cmwuaG9zdDsKCnZhciBvcHRpb25zID0gewoJcG9ydDogbXF0dF91cmwucG9ydCwKCWNsaWVudElkOiAnbXF0dGpzXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zdWJzdHIoMiwgOCksCgl1c2VybmFtZTogYXV0aFswXSwKCXBhc3N3b3JkOiBhdXRoWzFdLAp9OwoKdmFyIHN0YW5kYXJkUHJlc3N1cmUgPSAzMDAwOwp2YXIgbWluRGVsdGFQcmVzc3VyZSAgPSAxMDsKdmFyIG1heERlbHRhUHJlc3N1cmUgID0gNjAwOwoKdmFyIG1pbkRlbHRhVGltZSA9IDE7CnZhciBtYXhEZWx0YVRpbWUgPSA1OwoKdmFyIHByZXNzdXJlID0gWzAsMCwwLDAsMF07CnZhciB0aW1lc3RhbXAgPSBbMCwwLDAsMCwwXTsKCmZ1bmN0aW9uIGdlbmVyYXRlRGF0YShjYWxsYmFjayl7ICAgCiAgICB2YXIgcmVzdWx0ID0gWyIiLCIiLCIiLCIiLCIiXTsgCiAgICBmb3IodmFyIGk9MDsgaTw1OyBpKyspewoJICAgIHZhciB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihtYXhEZWx0YVByZXNzdXJlLW1pbkRlbHRhUHJlc3N1cmUpKSttaW5EZWx0YVByZXNzdXJlOwoJICAgIGlmKGk9PTApewoJCSAgICBwcmVzc3VyZVtpXSA9IHN0YW5kYXJkUHJlc3N1cmUteTsKCQkgICAgdGltZXN0YW1wW2ldID0gbmV3IERhdGUoKTsKCSAgICB9ZWxzZXsKCQkgICAgcHJlc3N1cmVbaV0gPSBwcmVzc3VyZVtpLTFdLXk7CgkJICAgIHRpbWVzdGFtcFtpXSA9IHRpbWVzdGFtcFtpLTFdOwogICAgICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoobWF4RGVsdGFUaW1lLW1pbkRlbHRhVGltZSkpK21pbkRlbHRhVGltZTsKCQkgICAgdGltZXN0YW1wW2ldLnNldFNlY29uZHModGltZXN0YW1wW2ldLmdldFNlY29uZHMoKSArIHgpOwoJICAgIH0KICAgICAgICByZXN1bHRbaV0gPSBwcmVzc3VyZVtpXS50b1N0cmluZygpICsgIi0iICsgdGltZXN0YW1wW2ldLnRvU3RyaW5nKCk7CiAgICAgICAgCiAgICB9CiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpOwp9CgpmdW5jdGlvbiBpbnNlcnREYXRhKGVyciwgcmVzdWx0cywgY2FsbGJhY2spewogICAgaWYgKGVycikgdGhyb3cgZXJyOwoKICAgIHZhciBtc2cgPSAiIjsKICAgIHZhciBjbGllbnQgPSBtcXR0LmNvbm5lY3QodXJsLCBvcHRpb25zKTsKICAgIGNsaWVudC5vbignY29ubmVjdCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGZvcihsZXQgcmVjb3JkIG9mIHJlc3VsdHMpewogICAgICAgICAgICAgICAgY2xpZW50LnB1Ymxpc2goJ2lvdC90eXJlL3ByZXNzdXJlJywgcmVjb3JkLnRvU3RyaW5nKCksIGZ1bmN0aW9uKCkge30pOwogICAgICAgIH07CiAgICBjbGllbnQuZW5kKCk7CiAgICB9KTsgICAgCn0KCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGV2ZW50KSB7CiAgICBnZW5lcmF0ZURhdGEoZnVuY3Rpb24oZXJyLCBkYXRhKXsKICAgICAgICBpbnNlcnREYXRhKG51bGwsIGRhdGEpOwogICAgfSk7CiAgICBjb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayIpOyAgCn0KCg==
    commands:
      - 'npm install mqtt'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
